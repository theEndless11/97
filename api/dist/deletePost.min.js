"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=handler;var _mongoose=_interopRequireDefault(require("mongoose")),_db=require("../utils/db");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var postSchema=new _mongoose.default.Schema({message:String,timestamp:Date,username:String,sessionId:String}),Post=_mongoose.default.model("Post",postSchema);function handler(t,s){var r,n,a,o,u;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap((0,_db.connectToDatabase)());case 2:if("DELETE"!==t.method){e.next=25;break}if(e.prev=3,r=t.body,n=r.postId,a=r.username,o=r.sessionId,n&&a&&o){e.next=7;break}return e.abrupt("return",s.status(400).json({message:"Missing required fields: postId, username, sessionId"}));case 7:return e.next=9,regeneratorRuntime.awrap(Post.findById(n));case 9:if(u=e.sent){e.next=12;break}return e.abrupt("return",s.status(404).json({message:"Post not found"}));case 12:if(u.username!==a)return e.abrupt("return",s.status(403).json({message:"You can only delete your own posts"}));e.next=14;break;case 14:return e.next=16,regeneratorRuntime.awrap(u.deleteOne());case 16:s.status(200).json({message:"Post deleted successfully"}),e.next=23;break;case 19:e.prev=19,e.t0=e.catch(3),console.error(e.t0),s.status(500).json({message:"Error deleting post",error:e.t0});case 23:e.next=26;break;case 25:s.status(405).json({message:"Method Not Allowed"});case 26:case"end":return e.stop()}},null,null,[[3,19]])}
//# sourceMappingURL=deletePost.min.js.map
